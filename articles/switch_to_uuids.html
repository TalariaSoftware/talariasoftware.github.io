<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Switch to UUIDs | Talaria Software</title>



<meta name="description" content="Database keys that can&#39;t be guessed, don&#39;t overflow, and don&#39;t leak information.">



<link rel="icon" type="image/png"
  href="/images/favicons/favicon.png">

<link rel="icon" type="image/png"
  sizes="192x192"
  href="/images/favicons/favicon-192.png">

<link rel="apple-touch-icon-precomposed" type=""
  href="/images/favicons/favicon-57.png">

<link rel="apple-touch-icon-precomposed" type=""
  sizes="72x72"
  href="/images/favicons/favicon-72.png">

<link rel="apple-touch-icon-precomposed" type=""
  sizes="114x114"
  href="/images/favicons/favicon-114.png">

<link rel="apple-touch-icon-precomposed" type=""
  sizes="144x144"
  href="/images/favicons/favicon-144.png">



<meta name="twitter:card" content="summary" />
<meta name='twitter:site:id' content='@TalariaSoftware'>
<meta name='twitter:title' content='Switch to UUIDs'>
<meta name='twitter:creator:id' content='@ExMember'>
<meta name='twitter:image' content='https://talariasoftware.com/images/foot-color.png'>

<meta property='og:locale' content='en'>
<meta property='og:site_name' content='Talaria Software'>
<meta property='og:title' content='Switch to UUIDs'>
<meta property='og:type' content='website'>
<meta property='og:url' content='https://talariasoftware.com/articles/switch_to_uuids'>
<meta property='og:description' content='Database keys that can&#39;t be guessed, don&#39;t overflow, and don&#39;t leak information.'>
<meta property='og:image' content='https://talariasoftware.com/images/foot-color.png'>

    



<link rel="stylesheet"
  href="/assets/css/uswds-theme.css"
  media="screen">

<link rel="stylesheet"
  href="/assets/css/syntax.css"
  media="screen">


    
    <link href="https://app.talariasoftware.com/articles.xml" rel="alternate" title="Talaria Software articles" type="application/rss+xml">
    <link rel='stylesheet'
          href='https://use.fontawesome.com/releases/v5.4.1/css/all.css'
          integrity='sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz'
          crossorigin='anonymous'>

  </head>
  <body class="  ">

    <a class="usa-skipnav" href="#main-content">Skip to main content</a>

    




  <div class="usa-overlay"></div>

  <header class="usa-header usa-header--extended" role="banner">


  
    <div class="usa-navbar">
      <div class="usa-logo" id="header-logo">
        <a
          href="/"
          title="Home">
          
            <img
              class="usa-logo-img"
              src="/images/foot-color.png"
              alt="Talaria Software logo">
          
          <em class="usa-logo__text">
            Talaria Software
          </em>
        </a>
      </div>
      <button class="usa-menu-btn">Menu</button>
    </div>

    <nav role="navigation" class="usa-nav">
      <div class="usa-nav__inner">
        <button class="usa-nav__close">
          <img src="/assets/uswds/img/close.svg" alt="close">
        </button>

        
        
        
        <ul class="usa-nav__primary usa-accordion">
          
          <li class="usa-nav__primary-item">
            
              <a class=" usa-nav__link  " href="/articles">
                <span>Articles</span>
              </a>
            
          </li>
          
          <li class="usa-nav__primary-item">
            
              <a class=" usa-nav__link  " href="/articles/joyful_rails">
                <span>Joyful Rails</span>
              </a>
            
          </li>
          
          <li class="usa-nav__primary-item">
            
              <a class=" usa-nav__link  " href="https://app.talariasoftware.com/expertise_to_income">
                <span>Workbook</span>
              </a>
            
          </li>
          
          <li class="usa-nav__primary-item">
            
              <a class=" usa-nav__link  " href="https://app.talariasoftware.com/get_help">
                <span>Coaching</span>
              </a>
            
          </li>
          
          <li class="usa-nav__primary-item">
            
              <a class=" usa-nav__link  " href="/about">
                <span>About</span>
              </a>
            
          </li>
          
        </ul>
        

        

        
          
          <div class="usa-nav__secondary">
            <ul class="usa-unstyled-list usa-nav__secondary-links">
              
              
                <li class="usa-nav__secondary-item">
                  <a href="https://app.talariasoftware.com/kickoff_questionnaires/new"
                  >
                    Kickoff
                  </a>
                </li>
              
                <li class="usa-nav__secondary-item">
                  <a href="https://app.talariasoftware.com/accelerate_questionnaires/new"
                  >
                    Accelerate
                  </a>
                </li>
              
            </ul>
            
          </div>
          


        </div>
      </div>
    </nav>
  
  </header>




    
    


    

    

    
      
      




    
    

    
      <div class="usa-section">
  <div class="grid-container">
    <div class="grid-row grid-gap flex-align-start">
      <main class="usa-layout-docs usa-layout-docs__main usa-prose" id="main-content">
        <h1>Switch to UUIDs</h1>
        <h6>Published: Nov 10th, 2020</h6>
        
          <h6>Updated: Dec 2nd, 2020</h6>
        
        <p>This is part of <a href="/articles/joyful_rails">Joyful Rails</a>, a list of
recommendations to make developing your Rails app more productive and joyful.</p>

<p>In this article, we are talking about switching the database primary keys to
UUIDs, universally unique identifiers.</p>

<h2 id="when">When</h2>

<p>On one hand, it is not trivial to change a table’s primary key from the default
integer to UUIDs. For that reason, it is helpful to switch to UUIDs as early as
possible.</p>

<p>On the other hand, the benefits of using UUIDs are generally not an important
concern for new applications, so there is little reason to do it right away.</p>

<h2 id="why">Why</h2>

<p>By default, Rails uses integers as primary keys. Using UUIDs can help prevent a
few problems.</p>

<h3 id="integer-overflow">Integer overflow</h3>

<p>Integer primary keys increase monotonically for every new row. Eventually, the
primary key gets too large and new entries cannot be created.</p>

<p>Since Rails 5.1 the default is to use 64-bit integers, which means this will
not be a problem until you’ve created over <code class="language-plaintext highlighter-rouge">9*10^18</code> rows.</p>

<p>UUIDs are much larger (128-bits total) and chosen randomly. So even when
you have over <code class="language-plaintext highlighter-rouge">9*10^18</code> rows your primary key will not be the problem.</p>

<h3 id="guessable-primary-keys">Guessable primary keys</h3>

<p>Every new integer primary key is one more than the previous one, which means it
is trivial to guess what IDs have been created and which ones will be created
next.</p>

<p>Knowing what primary keys exist should not be a security issue by itself, but
you may still want to hide as part of a defense in depth.</p>

<h3 id="estimable-creation-rates">Estimable creation rates</h3>

<p>Every new integer primary key is one more than the previous one, which means it
is simple to find out how quickly they are being created.</p>

<p>That information may reveal how many users signed up yesterday or how many
orders were created this week.</p>

<p>For most applications, most of the time, no one cares and this is not an issue.
If it might be for you, using UUIDs as your primary keys can eliminate it.</p>

<h2 id="how">How</h2>

<h3 id="enable-uuids-in-postgresql">Enable UUIDs in PostgreSQL:</h3>

<p>We assume you have already made the <a href="switch_to_postgresql">switch to
PostgreSQL</a>.</p>

<ol>
  <li>Generate a migration: <code class="language-plaintext highlighter-rouge">rails generate migration EnableUuids</code>.</li>
  <li>Put this in the change method of the migration: <code class="language-plaintext highlighter-rouge">enable_extension 'pgcrypto'</code></li>
  <li>Run the migration: <code class="language-plaintext highlighter-rouge">rake db:migrate</code></li>
</ol>

<h3 id="configure-the-generators-to-use-uuids-as-primary-keys">Configure the generators to use UUIDs as primary keys:</h3>

<p>In <code class="language-plaintext highlighter-rouge">config/application.rb</code> add <code class="language-plaintext highlighter-rouge">config.generators.orm :active_record,
primary_key_type: :uuid</code>.</p>

<h3 id="test-the-change">Test the change</h3>

<p>After making a commit, test that this works by running <code class="language-plaintext highlighter-rouge">rails generate model
foo</code> and <code class="language-plaintext highlighter-rouge">rake db:migrate</code>.</p>

<p>The migration and schema should both indicate that the id is a UUID.</p>

<p>Run <code class="language-plaintext highlighter-rouge">rake db:rollback</code> and remove the generated files before continuing.</p>

<h2 id="gotchas">Gotchas</h2>

<p>When creating a foreign key column (using <code class="language-plaintext highlighter-rouge">references</code> or <code class="language-plaintext highlighter-rouge">belongs_to</code>) you must
indicate the type if the id is a UUID.</p>

<p>For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_table</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">id: :uuid</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
<span class="k">end</span>

<span class="n">create_table</span> <span class="ss">:comment</span><span class="p">,</span> <span class="ss">id: :uuid</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">belongs_to</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">type: :uuid</span>
<span class="k">end</span>
</code></pre></div></div>
<p>If you do not do this, there is a risk of silent errors when the UUIDs are
coerced into an integer to fit into a column that expects an integer.</p>

      </main>
    </div>
  </div>
</div>

    

    

    


  
<footer class="usa-footer">

  

  
    
    
    
    
  <div class="usa-footer__primary-section">
    <nav class="usa-footer__nav" aria-label="Footer navigation">
      <ul class="grid-row grid-gap">
        
        <li class="mobile-lg:grid-col-4 desktop:grid-col-auto usa-footer__primary-content">
          <a class="usa-footer__primary-link" href="/articles">
            Articles
          </a>
        </li>
        
        <li class="mobile-lg:grid-col-4 desktop:grid-col-auto usa-footer__primary-content">
          <a class="usa-footer__primary-link" href="/articles/joyful_rails">
            Joyful Rails
          </a>
        </li>
        
        <li class="mobile-lg:grid-col-4 desktop:grid-col-auto usa-footer__primary-content">
          <a class="usa-footer__primary-link" href="https://app.talariasoftware.com/expertise_to_income">
            Workbook
          </a>
        </li>
        
        <li class="mobile-lg:grid-col-4 desktop:grid-col-auto usa-footer__primary-content">
          <a class="usa-footer__primary-link" href="https://app.talariasoftware.com/get_help">
            Coaching
          </a>
        </li>
        
        <li class="mobile-lg:grid-col-4 desktop:grid-col-auto usa-footer__primary-content">
          <a class="usa-footer__primary-link" href="/about">
            About
          </a>
        </li>
        
      </ul>
    </nav>
  </div>
  

  
  <div class="usa-footer__secondary-section">
    <div class="grid-container">
      <div class="grid-row grid-gap">
        <div class="usa-footer__logo grid-row mobile-lg:grid-col-6 mobile-lg:grid-gap-2">
          
            <div class="mobile-lg:grid-col-auto">
                
                  <img class="usa-footer__logo-img" src="/images/foot-color.png" alt="Talaria Software logo">
                
              </div>
            
          

          
          <div class="mobile-lg:grid-col-auto">
            <h3 class="usa-footer__logo-heading">Talaria Software</h3>
          </div>
          
        </div>

        
        <div class="usa-footer__contact-links mobile-lg:grid-col-6">
          
          
            <div class="usa-footer__social-links grid-row grid-gap-1">
              <div class="grid-col-auto">
                
                  <a class="usa-social-link usa-social-link--twitter" href="https://twitter.com/talariasoftware">
                    <span>Twitter</span>
                  </a>
                
                  <a class="usa-social-link usa-social-link--github" href="https://github.com/talariasoftware">
                    <span>GitHub</span>
                  </a>
                
              </div>
            </div>
          
          
            <h3 class="usa-footer__contact-heading">Contact</h3>
            
            
              <address class="usa-footer__address">
                
                <div class="usa-footer__contact-info grid-row grid-gap">
                
                    <div class="grid-col-auto">
                      <a href="mailto:help@talariasoftware.com">
                        help@talariasoftware.com
                      </a>
                    </div>
                
                </div>
              </address>

              
                <div class="usa-footer__contact-info grid-row grid-gap">
                  <ul class="policy-list usa-list usa-list--unstyled text-right">
                    
                        <li class="display-inline">
                          <a href="/privacy_policy">
                            Privacy Policy
                          </a>
                        </li>
                    
                        <li class="display-inline">
                          <a href="/terms_of_service">
                            Terms of Service
                          </a>
                        </li>
                    
                  </ul>
                </div>
              

              <div>
                &copy; 2015&mdash;2021 Talaria Research LLC
              </div>
          
        
      </div>
      
      </div>
    </div>
  </div>
  

</footer>





    





  
    
      <script src="/assets/uswds/js/uswds.min.js" async></script>
    

  
    






  </body>
</html>
